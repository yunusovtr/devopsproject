# Проектная работа по курсу "DevOps практики и инструменты"
Целью проектой работы является демонстрация и закрепление навыков работы с инструментами сборки приложений, их деплоя, а также организация обратной связи в виде сбора метрик и логирования.

Данный репозиторий содержит необходимый код для развёртывания как целевого приложения с инструментами мониторинга и логирования, так и среды его автоматизированного развёртывания на базе GitLab CI.

Для реализации собственных целей обучения был выбран деплой в среду on-premise Kubernetes, размещенный на облачных виртуальных машинах в Yandex.Cloud.

В целях упрощения структуры проигнорированы вопросы безопасности, управление CI и деплой самого приложения осуществляются в едином кластере Kubernetes, а хранение реализовано в виде простого сервера NFS без резервирования. Предполагается, что эти вопросы остаются за рамками данной проектной работы.

# Описание приложения

Приложение состоит из:
- 1
- 2
- 3

---
# Описание инфраструктуры

Четыре виртуальных машины. Одна для организации хранилища. три для кластера Kubernetes - одна для мастера и две рабочие ноды.

[разместить простую схему]


# Последовательность действий для развёртывания

## Запуск проекта

### Требования к ПО на локальной машине

ОС: Linux

Программы:
- Ansible 2.9
- Helm 3
- kubectl 1.24
- jq
- Terraform v.1.2.3
- yc
- git

---

### Подготовка среды
- Скопировать файл terraform.tfvars.example в terraform.tfvars и прописать в нём значения переменных.
- Сделайте резевную копию ~/.kube/config, если данные там нужны.
- Установите VPN соединение с ip-адресом вне России.
- Запустить в корне init.sh

## Учётная запись afraid.com
- Подготовить новую учётную запись на сайте afraid.com без закреплённых доменов.
- Создать желаемый домен третьего уровня, например yunusovtr.my.to, прикрепить любой ip-адрес
- Создать поддомены четвёртого уровня к созданному домену третьего уровня строго следующих наименований и строго к тому же айпи, что и домен третьего уровня:
  - gitlab
  - kas
  - minio
  - registry
- Проверить, должно было получиться что-то вроде:
  - yunusovtr.my.to
  - gitlab.yunusovtr.my.to
  - kas.yunusovtr.my.to
  - minio.yunusovtr.my.to
  - registry.yunusovtr.my.to
- На странице Dynamic DNS опция "Link updates of the same IP together?" должна быть ON
- Добавить логин и пароль от afraid.com в файл переменных терраформа в виде переменных afraid_account и afraid_pass.

## CHANGE LOG

- Написал тераформ манифест для создания кластера Kubernetes
- Написал провижининг для гитлаб сервера и создания на нём нужных репозиториев с копированием данных