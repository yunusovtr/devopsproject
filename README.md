# Проектная работа по курсу "DevOps практики и инструменты"

## Тема проектной работы

Создание процесса непрерывной поставки для
приложения с применением Практик CI/CD и быстрой
обратной связью

## Цель работы

Целью проектой работы является демонстрация и закрепление навыков работы с инструментами сборки приложений, их деплоя, а также организация обратной связи в виде сбора метрик и логирования.

## Требования к работе

- Автоматизированные процессы создания и управления платформой
  - Ресурсы Ya.cloud
  - Инфраструктура для CI/CD
  - Инфраструктура для сбора обратной связи
- Использование практики IaC (Infrastructure as Code) для управления конфигурацией и инфраструктурой
- Настроен процесс CI/CD
- Все, что имеет отношение к проекту хранится в Git

## Содержание текущего репозитория

- в директории terraform содержатся манифесты Terraform для разворота кластера Kubernetes в Yandex Cloud с провижинингом установки GitLab в этот кластер с последующей инициализацией в нём двух репозиториев приложения и одного репозитория helm-чартов
- в директории src находится начальный код приложения, состоящего из двух компонентов UI и Crawler, содержащий также код для пайплайнов CI для этих компонентов. Каждый из компонентов в результате провижининга размещается каждый в своём репозитории GitLab.
- в директории src также размещены чарты Helm для деплоя итогового окружения, которые при провижининге переносятся в третий репозиторий GitLab

## Описание разворачиваемой инфраструктуры

## Описание приложения

Приложение состоит из:
- 1
- 2
- 3

## Первичное развёртывание

### Требования к локальному компьютеру для запуска первичного развёртывания

ОС: Linux/WSL

Программы:
- Ansible 2.9
- Helm 3
- kubectl 1.24
- jq
- Terraform v.1.2.3
- yc
- git
- nslookup

### Подготовка к развёртыванию

- Скопируйте файл terraform.tfvars.example в terraform.tfvars и пропишите в нём значения переменных.
- Подготовьте домены в сервисе Dynamic DNS сайта afraid.com:
  - Подготовте новую учётную запись на сайте afraid.com без закреплённых доменов.
  - Создайте желаемый домен третьего уровня, например yunusovtr.my.to (лучше выбрать не my.to, а любой из предлагаемых редко используемый домен второго уровня, чтобы иметь меньше проблем с выпуском сертификата), прикрепить любой ip-адрес
  - Создайте поддомены четвёртого уровня к созданному домену третьего уровня строго следующих наименований и строго к тому же айпи, что и домен третьего уровня:
    - gitlab
    - kas
    - minio
    - registry
  - Проверьте, должно было получиться что-то вроде:
    - yunusovtr.my.to
    - gitlab.yunusovtr.my.to
    - kas.yunusovtr.my.to
    - minio.yunusovtr.my.to
    - registry.yunusovtr.my.to
  - Убедитесь, на странице Dynamic DNS опция "Link updates of the same IP together?" должна быть ON
  - Не забудьте добавить логин и пароль от afraid.com в файл переменных терраформа в виде переменных afraid_account и afraid_pass.
- При развёртывании установите VPN соединение с ip-адресом вне России.

### Заполнение переменных Terraform

### Запуск развёртывания

- Запустить в корне init.sh

### Удаление инфраструктуры

## CHANGE LOG

- Написал тераформ манифест для создания кластера Kubernetes
- Написал провижининг для гитлаб сервера и создания на нём нужных репозиториев с копированием данных